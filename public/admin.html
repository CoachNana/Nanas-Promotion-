<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin — Orders & Upload</title>
<style>
body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:#0b1120;color:#eaf2ff}
.wrap{max-width:980px;margin:0 auto;padding:24px}
.card{background:#0e1629;border:1px solid rgba(255,255,255,0.08);border-radius:12px;padding:18px;margin-top:16px}
table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid rgba(255,255,255,0.08);padding:8px;text-align:left;font-size:14px}
.btn{background:#e63946;border:0;color:#fff;font-weight:800;padding:10px 16px;border-radius:10px;cursor:pointer}
.ghost{background:transparent;border:1px solid rgba(255,255,255,0.2);color:#d9e9ff;font-weight:700;padding:9px 14px;border-radius:10px;cursor:pointer}
input[type=file]{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.2);background:transparent;color:#eaf2ff;margin:6px 0}
.muted{color:#9db1d1}
</style>
</head>
<body>
<div class="wrap">
  <h1>Admin — Orders & Ticket Upload</h1>

  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap">
      <h3 style="margin:0">Orders</h3>
      <div>
        <a class="ghost" href="/admin/orders.csv">Download CSV</a>
        <a class="ghost" href="/">Back</a>
      </div>
    </div>
    <div style="overflow:auto">
      <table id="ordersTable">
        <thead>
          <tr>
            <th>ID</th><th>Gateway</th><th>Status</th>
            <th>Name</th><th>Phone</th><th>Type</th>
            <th>Qty</th><th>AED</th><th>Txn/Link</th><th>Created</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px 0">Upload Ticket</h3>
    <form id="uploadForm">
      <input type="file" id="ticketFile" accept=".pdf,.png,.jpg,.jpeg" required/>
      <button class="btn" type="submit">Upload</button>
    </form>
    <div id="result" class="muted" style="margin-top:12px"></div>
  </div>
</div>

<script>
async function loadOrders(){
  const r=await fetch('/admin/orders.json');
  const orders=await r.json();
  const tb=document.querySelector('#ordersTable tbody');
  tb.innerHTML=orders.map(o=>`
    <tr>
      <td>${o.id||''}</td>
      <td>${o.gateway||''}</td>
      <td>${o.status||''}</td>
      <td>${o.name||''}</td>
      <td>${o.phone||''}</td>
      <td>${o.ticketType||''}</td>
      <td>${o.qty||''}</td>
      <td>${o.amount||''}</td>
      <td>${o.gateway_txn?o.gateway_txn:(o.link?('<a href="'+o.link+'" target="_blank">link</a>'):'')}</td>
      <td>${o.created_at||''}</td>
    </tr>`).join('');
}
loadOrders();

document.getElementById('uploadForm').addEventListener('submit', async e=>{
  e.preventDefault();
  const f=document.getElementById('ticketFile').files[0];
  if(!f){alert('Select a file');return;}
  const fd=new FormData();
  fd.append('ticket',f);
  const r=await fetch('/admin/upload-ticket',{method:'POST',body:fd});
  const d=await r.json();
  if(!d.url){alert('Upload failed');return;}
  document.getElementById('result').innerHTML=`Sharable link: <a href="${d.url}" target="_blank">${d.url}</a>`;
});
</script>
</body>
</html>
